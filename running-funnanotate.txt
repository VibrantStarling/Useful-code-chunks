## get funannotate through singularity
# singularity build funannotate.sif docker://nextgenusfs/funannotate:latest

# get your files in order
GENOME="genome.fna"
OUT_DIR="outdir_name"

## CLEAN
# make sure your genome has simplified names. Augustus does not deal well with contig names longer than 16 characters
# this code will remove any trailing characters after the first space of you contig names inplace, so remove the -i flag or make a back up if you need to
sed -i 's/\s.*$//' ${GENOME}

# alternatively, funannotate has a sorting script which will rename and sort contigs by length
singularity exec -B ${PWD}:${PWD},${HOME} ${HOME}/funannotate.sif  funannotate sort -i Spades.genome.cleaned.fa -b scaffold -o Spades.genome.sorted.fa

## MASK
# if you haven't already masked your genome, funannotate can do this very simply with tantan (by default, see https://funannotate.readthedocs.io/en/latest/commands.html for options)
singularity exec -B ${PWD}:${PWD},${HOME} ${HOME}/funannotate.sif funannotate mask -i Spades.genome.cleaned.fa --cpus 12 -o masked-${GENOME}

## TRAIN
# replace 'ERR*_1.fastq.gz' and 'ERR*_2.fastq.gz' with whatever pattern covers all the SRA libararies you want to include
singularity exec -B ${PWD}:${PWD},${HOME} ${HOME}/funannotate.sif -i masked-${GENOME} -o ${OUT_DIR} -l ERR*_1.fastq.gz -r ERR*_2.fastq.gz \
--species "Your species" --strain "Your strain" --cpus 48 --max_intronlen 100000



